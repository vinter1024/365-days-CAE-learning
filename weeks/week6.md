## Day 32 ABAQUS的网格划分

ABAQUS的网格划分方法是首先对几何模型布置种子来控制单元密度和位置，然后使用自动算法直接生成网格。下面就详细地介绍一下在ABAQUS中网格的划分方法。
01 网格种子

全局种子：设定整个部件或者实体上的单元尺寸。（Mesh,edge上seed的多少决定region 里mesh的多少）
边上的种子：设定边上的单元数目或者单元尺寸大小，在Constraints一栏中有三个选择：

◆ 边上的种子无约束：划分网格时，边上的节点数目可以超出或者少于种子的数目，无约束的种子用圆圈表示。
◆ 边上的种子受部分约束：划分网格时，边上的节点数目可以超出种子的数目，但不能少于种子的数目。受约束的种子用三角形表示。
◆ 边上的种子完全受约束：划分网格时，边上的节点位置与种子的位置严格吻合，受完全约束的种子用方形表示。

有时候我们需要对局部网格进行加密或者进行结构化网格划分时需要进行二合一或者三合一的操作时就要对边的种子进行控制。见图1和图2。

<img width="560" alt="image" src="https://user-images.githubusercontent.com/43568675/188413596-704f8d62-831a-414e-b8b1-c94ab20b47b9.png">


02 单元形状
网格控制选项中可以选择单元类型。
1. 对于二维几何模型，可以选择以下的单元形状：
*  Quad：网格中完全使用四边形单元。
*  Quad-dominated：网格中主要使用四边形单元，但在过渡区域允许出现三角形单元。（选择此类型更容易实现从粗网格到细网格的过渡。）
*  Tri：网格中完全使用三角形网格单元。

2. 对于三维几何模型，可以选择以下的单元形状：
*  Hex：网格中完全使用六面体单元。
*  Hex-dominated：网格中主要使用六面体单元，但在过渡区域允许出现楔形单元。
*  Tet：网格中完全使用四面体单元。
*  Wedge：网格中完全使用楔形单元。

03 网格划分技术
1. 在网格控制选项中显示了三种网格划分技术：
* Structured（结构化网格）：将一些标准的网格模式应用于一些形状简单的几何区域，结构化网格区域显示为绿色。
* Sweep（扫掠网格）：对于二维几何模型，首先在边上生成网格，然后沿扫掠路径拉伸得到二维网格；对于三维几何模型，首先在面上生成网格，然后沿扫掠路径拉伸得到三维网格。扫掠网格区域为黄色。
* Free(自由网格)：自由网格是最为灵活的网格划分技术，几乎可以用于任意的几何形状。自由网格划分区域为粉红色。(见图3)

2.  如果某个区域显示为橙色，表明无法使用目前的网格划分技术，这时需要对模型进行切分或者使用其他的网格划分方法。
<img width="642" alt="image" src="https://user-images.githubusercontent.com/43568675/188413659-b93cc55f-b79e-494c-bda3-571b72383f43.png">

*这里说明网格划分具有模型检查机制，能够对模型是否适用于某种网格划分进行预先检测

04 网格划分算法
1. 在网格控制选项中提供了两种算法：
* Medial Axis(中性轴算法)：首先把要划分网格的区域分为一些简单的区域，然后使用结构化网格划分技术对这些区域进行网格划分。
* Advancing Front算法：首先在边界上生成四边形网格，然后再向区域内部拓展。

<img width="498" alt="image" src="https://user-images.githubusercontent.com/43568675/188413842-1beed223-291b-4e05-b17a-c428969397c5.png">

2. 对比两种算法生成的网格发现：
* Medial Axis算法更容易得到形状规则的网格，但网格与种子的位置吻合的较差。
* Advancing Front算法得到的网格可以与种子的位置很好地吻合，而且更容易得到单元大小均匀的网格，但在较窄区域为了精确匹配每粒种子可能会使网格倾斜。

在实际应用中，具体使用哪种网格算法更好，需要根据具体情况而定。
例如在ABAQUS显式分析中网格中的小单元会限制增量步长，这时使用Advancing Front算法可以得到大小更加均匀的网格。

## Day 33 comsol 手动网格剖分技巧：几何分割的概念

> [借助分割技巧改进网格剖分](https://cn.comsol.com/blogs/improving-your-meshing-with-partitioning/#goto-comments)

- [x] 网格剖分算法的工作方式

1. 缺省网格设定：始终使用自由剖分四面体网格来将任意体离散为多个更小的单元。
2. 缺省单元类型是四面体单元，因为对于任意几何，不论拓扑多复杂，都可以细分并近似为四面体。

*有些情况下更适合使用其他网格

网格剖分算法示意图
<img width="697" alt="image" src="https://user-images.githubusercontent.com/43568675/188639110-76044c83-0bf0-4a35-8c8e-383ee3318801.png">

圆柱（左）表面使用三角形单元（灰色）进行网格剖分；四面体网格剖分算法使用四面体单元对体进行细分（青色）。出于清晰的考虑，两端已省略。

* 四面体网格剖分算法会首先在您希望进行网格剖分的体的所有面上应用三角形网格。体随即被细分为四面体，以便能考虑到边界上的所有三角形，同时保持体内四面体的尺寸和形状都满足指定的尺寸和增长准则。

* 如果您收到类似“处理几何面上的边界线单元失败”的错误消息，可能是因为四面体的形状在该过程中变得过于扭曲。

自由剖分四面体网格算法的执行可能会遇到一些问题，比如：

* 部件非常复杂，混合了非常详细的区域和稀疏网格。
* 用来定义域的边和边界的纵横比非常大。



- [x] 简化复杂几何
开始之前，让我们先考虑一个稍微复杂的几何：螺旋几何基元。

继续操作，打开一个新的 COMSOL 模型文件并创建一个十圈螺旋，然后通过缺省设定进行网格剖分，如下图所示。


<img width="672" alt="image" src="https://user-images.githubusercontent.com/43568675/188639803-46d13263-7cf4-495a-bfb2-3d1f5c418132.png">

剖分一个十匝几何基元。十圈螺旋基元及对应的缺省四面体网格。

在剖分这一相对简单部件时您可能会发现，剖分步骤花费的时间相对较长。因此，我们将分析如何借助分割来简化几何。

1. 初步简化步骤
* 在几何序列中增加一个工作平面，沿螺旋的长度方向对其进行二等分
* 然后增加分割特征，使用工作平面作为分割对象。

<img width="703" alt="image" src="https://user-images.githubusercontent.com/43568675/188641805-796e07cf-4c67-42dd-9f7f-b354fa21f943.png">

用于分割螺旋的工作平面。

* 得到的十匝螺旋对象现在包含 20 个不同的域，每个域都代表了半匝螺旋。
* 重新对模型进行网格剖分时，耗时大为缩短，与初始问题相比，每个域均代表了一个更加简单的剖分问题，
* 可以利用并行或多核计算机对这些域进行网格剖分

2. 进一步简化步骤

我们现在有 20 个不同的域，已将螺旋的 6 个表面再分割为 102 个表面，还引入了用于分隔域的内边界。

虽然现在几何的网格剖分速度要快很多，但我们增加了过多的域和边界，可能会影响对材料属性与边界条件的设定；实际上，我们希望在网格剖分时使用分割的几何，同时能在设定物理场时忽略分割。

* 增加虚拟操作 > 网格控制域运算。此特征会将用于定义螺旋的所有 20 个域作为输入，将初始螺旋作为输出，在设定材料属性与物理场时，只需处理 1 个域和 6 条边界。
 
 <img width="683" alt="image" src="https://user-images.githubusercontent.com/43568675/188642808-986678d9-c2b2-4ef6-89fa-3bab5a977dd6.png">

 网格控制域将指定这些是仅用于网格剖分的不同的域。


3. 优势

* 在剖分该几何时同时利用这两大优势。网格剖分花费的时间相对较短，而且能轻松进行物理场设定。
* 比如外形像梳子、蛇纹石或包含许多孔、开孔对象的域，或嵌入其中的域，所有这些情况都应考虑使用分割。
* 并非必须使用平面进行分割，还可以创建并使用其他对象进行分割。

- [x] 高纵横比几何

如何保留几何的微小特征

<img width="686" alt="image" src="https://user-images.githubusercontent.com/43568675/188642865-da839006-8b4d-4ccb-a86a-86cbaf147f5a.png">

要进行网格剖分的流动域。从主管道上向外拉伸的三个包含更小圆角的小型入口。

在上方几何中，从一个大型管道向外拉伸出三个较小的管道。二者的过渡区域采用了小圆角，其尺寸不到管道体积的 1/100。如果我们采用缺省的网格设定来剖分域，则会在整个过程中采用相同的设定。但我们更希望在入口处采用较小的网格尺寸。

1. 缺省网格会在模型的所有单元中使用同一设定，这并不太适用于这一场景。
2. 我们可以在网格中增加额外的尺寸特征，并在小管道周围的所有面中应用这些特征来调整边界处的单元尺寸，但这并不是最佳选择。这需要进行大量操作，而且并非完全能实现我们的目的。
3. 我们还可以使用分割来定义希望应用不同网格设定的小体。下图中，每个小管道的周围加入了一个额外的圆柱，并向下延伸到主管道处。

<img width="691" alt="image" src="https://user-images.githubusercontent.com/43568675/188643148-a7238cd5-11b4-47e0-82c4-6db8142dd216.png">

将用于分割蓝色域的额外的域（线框）。

<img width="700" alt="image" src="https://user-images.githubusercontent.com/43568675/188643823-a5913468-9420-4e52-aafd-23a49a510ced.png">

分割操作结果。

如上图所示，这些附加的圆柱对象可用于分割原始模拟域。

我们将再次使用网格控制域将该几何简化为单个域，方便物理场和材料设定。

执行网格剖分步骤时，可在网格序列中增加尺寸特征，以设定这些新分割域的单元尺寸。这样，我们将能控制这些域的单元尺寸，使网格剖分更为简单。


<img width="720" alt="image" src="https://user-images.githubusercontent.com/43568675/188644944-3ec1c7ac-b9b5-4536-8683-b3186d19d081.png">

可以在每个分割的几何中应用不同的尺寸特征。

- [x]  自动网格剖分失败后如何操作？

对于文中提到的几何，我们只需花费很少的精力或略微修改缺省网格设定即可完成网格剖分。

一个无法通过网格剖分算法在相对合理的时间内完成剖分的几何。这时应该如何处理呢？

1. 分治算法。
当碰到一个未进行网格剖分的域时，可以使用分割将它分为两个域。尝试单独对每个域进行网格剖分。如果其中一个域未剖分，继续分割每半个域。通过这一方法，您将能快速放大原始域中的问题区域。随即决定是否希望通过虚拟操作简化几何的问题部分，或者使用此处列出的技巧对子域逐个进行剖分，您甚至能综合使用这两个技巧。

2. 在导入几何的所有边界上应用自由剖分三角形网格。
与体的网格剖分相比，对表面进行网格剖分更快，而且成功率极高。只需目测一下生成的表面网格，便能轻松发现模型中的小特征及问题区域。一旦了解问题所在之处，即可删除自由剖分三角形网格，因为这一剖分算法通常希望调整边界上的网格，但如果定义了表面网格，将不会执行此操作。

3. 除了我们提到的用于简化几何以便执行网格剖分的虚拟操作，您还可以使用修复和削除功能来清理从其他源中获取的 CAD 数据。虚拟操作将为 CAD 几何简单创建一个抽象对象，只能在 COMSOL 软件内使用，相比之下，修复和削除操作会直接修改 CAD 并创建一个修改的 CAD 表征，支持从COMSOL Multiphysics 写出并写入其他软件包。

- [x]  分割在网格剖分中的用法总结
我们已分析了缺省网格设定并非最优方案的两个不同的典型案例：极度复杂的域和带有极端纵横比的域。这两种情况下，我们都可以使用分割与网格控制域虚拟操作特征来简化网格剖分操作。

我们还提到了不使用缺省设定对几何进行网格剖分的应对策略。另外还需注意一点，当导入的 CAD 几何主要用于制造而非分析目的时，往往会出现这类情况。如果 CAD 文件包含许多装饰性而非功能性的特征，或者您非常确定它们不会影响问题的物理场，可以考虑在导入 COMSOL Multiphysics 之前先在原始 CAD 包中移除这些特征。

如何结合分割与扫略网格剖分，这是 COMSOL Multiphysics 的另一项非常强大的技巧。

## Day 34 网格划分设计

- [x]  网格设计而非划分
1. 在进行数值模拟计算（包括FEA、CFD 等）中，网格得质量对分析计算得结果有至关重要的影响。
* 高质量得网格是高精度分析结果得保证，而质量不好或者差得网格，则可能会导致计算得无法完成或者得到无意义得结果。
* 划分网格内部的计算方程需要设计出好得网格，计算才能更准确。
* 在一个完整得分析计算过程中，与网格设计和修改相关得前处理工作占到了CAE 工程师工作量得70－80％，CAE 工程师往往要花费大量得时间来进行网格处理，真正用于分析计算得时间很少，所以主要得瓶颈在于如何快速准备好高质量得满足分析计算要求得网格。


2. 针对一个具体得分析计算要求，要获得一个满足该分析计算得高质量网格，需要从以下几个方面进行综合考虑：
* 分析计算得目得（定性还是定量？）。
* 分析计算得类型，如强度分析、刚度分析、耐久性分析、NVH 分析、碰撞分析、CFD 分析、热流分析、动力学响应分析等。（不同得分析类型对网格得质量和形状有不同得要求。）
* 分析计算得时间要求。（要求时间得紧迫与否也决定了采用何种网格形式）
* 分析计算所采用得求解器。（不同得求解器对不同得分析问题有特定得网格形式和要求）
* 分析计算可能应用得单元类型。（所应用得求解器可以采用得单元类型，也会决定网格得质量与形状要求）
* 尽可能采用蕞好得网格类型。（对于面，尽可能采用四边形网格；对于体，尽可能采用六面体单元）由此可见，满足计算分析要求得高质量得网格是由前处理工程师精心“设计”出来得，而不是随随便便“划分”出来得。

- [x] 四面体和六面体单元比较

1. 四面体和六面体选择问题

网格划分得相关问题很多，比如薄壳处理，一阶单元和二阶单元选择，单元配合等等。

目前，基本上大部分得有限元前处理软件都基本实现了对面单元得自动四边形划分，但是自动六面体单元还是一个难点，有些号称能够自动化六面体划分得，其实采用自欺欺人得办法（划分只有表面网格是六面体，但是扒开了看，里层多数还是采用四面体），能够自动划分出完美得六面体网格基本还是难题。

2. 六面体优势有：
*  美。不要小看这一点，网格得美与否对结果得影响其实也是非常大得。划分网格就像打磨一件艺术品一样。“漂亮”得网格算出来正确结果得可能性可能吗？要比“糟糕得”网格大得多。
*  理论上六面体得精度要比四面体高，这里只谈一阶单元（二阶两者精度相当）。在有限元理论上也介绍得很明白，一阶四面体单元是属于常应变单元，所谓得常应变单元就是单元只存在一个应力和应变，没有应力梯度。而六面体单元则是梯度单元，只要不是缩减积分单元，单元内部是可以存在多个应力和应变积分点得，这样可以准确得描述梯度变化区域。也就意味着，如果是同等精度得话，六面体在应变梯度变化大得地方变形得更加合适。
*  同等模型尺寸下，六面体得节点数量要比四面体少得多。例如，50*75*50 得立方体，5mm 得网格大小，如果在四面体下，节点数14658 个，单元数9759，而在同等大小得尺寸得六面体下，节点数1936，单元数 1500。也就是说网格数量大幅度减少。

3. 四面体优点：
四面体虽然在算法上好像优势不大，但是瑕不掩瑜。四面体本身可填充任何几何形状，这个特性是六面体无法比拟得。
*  网格划分快捷
这是四面体网格蕞大得特点，不管是什么类型得几何体，通常都可以一键操作，再复杂得结构，分分钟就能得到一个网格出来。对于复杂几何体来说，这是非常重要得，以前发动机分析，六面体网格，没有半个月得功夫，怎能完成，现在也就半天功夫。
*  网格修改方面
网格得修改体现在两个方面，第壹，网格可以很容易随着外界CAD 得变化而变化，如果是六面体网格，那工作量就大得去了。第二，网格可随处任意加密，也是一键操作。四面体这些属性，可以帮助四面体网格实现Adaptive Mesh（自适应网格划分），让系统在应力梯度高得地方自动实现网格加密，这也是六面体网格无法想象得。
*  局部网格质量保证
为保证结果计算得准确性，CAE 工程师会对网格质量有一定得要求，希望六面体能够尽量往正方体靠拢，而四面体则尽量接近等边四面体。但是对于某些薄壳，形状怪异之处，六面体根本是不可能做到得，而四面体则可以使得网格总体质量保证在一个可以接受得范围之内。
*  通用，节省成本
大多数得CAE 软件都具备了自动划分四面体网格得功能，而且质量都还是相当得不错。对于复杂结构，比如上文所展示得活塞，想要变成六面体，必须得借助专门网格划分工具了，对于工程师来说要花时间学习，对于公司来说要增加采购成本。

4. 四面体网格和六面体网格各有优劣。那在工程中如何选择呢？

在CAE 工程中，生产效率提高主要包括了以下几个方面：
* 模型时间：在有限元分析中，蕞主要得时间就是网格划分了。前文说了，大多数情况下六面体划分网格得时间肯定要比四面体要长得多。
* 计算成本：如果在网格精度相同得情况下，如果六面体得网格质量能保证得很好，那么计算成本肯定会大大降低。
* 数值精度：求解得结果当然是为了优化产品，优化产品得前提是详细了解产品内部受力分布及大小。在数值计算上，六面体也占有一定得优势。

所以说 四面体网格和六面体需要针对具体模型具体分析了，不过现在得趋势是往着四面体方向发展。

- [x] 各种单元使用条件
一般来说，单元得个数越多，阶数越高，网格越密，总体刚度越小，有限元解越接近精确解。但是，并不是单元越密越好，对于网格划分不合理得情况，如很多单元共用一个节点，单元中存在大钝角、小锐角等等，都不推荐过细单元网格，而且过细得网格划分使计算需要更多CPU 时间。

1. 一维单元
杆单元：单元内部应力一样，即使分得再细也不会改变求解精度。如果将一根构件分成多个单元，反而变成不稳定结构。
梁单元：也可不太考虑单元划分，因为即使将一根构件化成一个梁单元，也能很好地反映弯曲变形。

2. 二维单元
常用四节点四边形单元，如果不满足可加密网格。四边形内角常不小于45 度不大于135 度，其长宽比通常不大于10 倍，应避免扭曲单元。板单元中将板厚得5 倍作为单元长度已足够，然而可根据求解要求，适用场合，将单元长度缩短或加长。为了得到精度良好得应力分析得结果，尽可能把四边形单元划分成正方形，三角形单元划分成正三角形。

3. 三维单元
对于实体一般选择六面体单元和带中间节点得四面体单元（即二阶四面体单元：quadratic tetrahedron element）。六面体单元和带中间节点得四面体单元得计算精度都很高，一个六面体单元有8 个节点，计算规模小，然而复杂得结构很难划分出好得六面体单元；而带中间节点得四面体单元恰好相反，复杂结构也能轻易地划分出四面体，但是每个单元有10 个节点，总节点数比较多，使计算量增大很多。总之，一定要明确结构仿真分析得目得，计算结果得应用场合、目得不同，单元划分可能也不相同。

具体如下所述：
四面体单元是 COMSOL 中大部分物理场得缺省单元类型。四面体也称简化网格，简言之，它是指任何三维体都可以利用四面体进行网格剖分，而不论其形状或是拓扑如何。它也是唯一一种可用于自适应网格细化得单元类型。因此，四面体通常是第壹选择。
另外三种单元类型（六面体、棱柱和金字塔形）仅用于确实需要时。
首先应注意得是，这些单元并非总能剖分具体几何。根据剖分算法，用户通常需要进行更多得输入来创建这类网格，因此您应该首先问一下自己是否需要这么操作，之后再进行操作。这里，我们将介绍使用六面体和棱柱单元原因。金字塔形单元仅在需要在六面体和四面体网格之间创建一个过渡区域时使用。

早期程序主要针对那些内存极小得计算机编写。因此，会使用一阶单元（通常有特定得积分方案）来节省内存与时钟周期。但在结构力学问题中，使用一阶四面体单元会带来严重得问题，而一阶六面体则可以给出精确得结果。作为这些较早期代码得遗留产物，现在，许多结构工程师更喜欢使用六面体而非四面体。事实上，在 COMSOL 中使用二阶四面体单元求解结构力学问题会得到精确得结果，与六面体单元得差别仅在于内存需求和求解时间。

在 COMSOL 中使用六面体和棱柱单元得主要原因是，它们可以极大地降低网格中得单元数。这些单元可能有极高得纵横比（蕞长边对蕞短边得比例），而用于创建四面体网格得算法则会尽量保持纵横比趋于统一。当您知道解在特定方向上会逐渐变化，或者您对这些区域中得精确解并不感兴趣，因为您知道感兴趣得结果在模型得其他位置时，使用具有高纵横比得六面体和棱柱单元将较为合理。

- [x] 一阶与二阶四面体单元区别

1. 一阶实体四面体单元
*  一阶（草稿品质）四面体单元在体内沿着面和边缘模拟一阶（线性）位移场。一阶（线性）位移场命名了该单元得名称：即一阶单元。在材料力学中，应变是位移得一阶导数，那么，应变（从位移得导数中求出）和应力在一阶四面体单元中均为常数。
*  每个一阶四面体单元共有四个节点，分别对应四面体得四个角点。每个节点有三个自由度，意味着节点位移可完全由三个位移分量来表示。
*  一阶单元得边是直线，面是平面。在单元加载变形后，这些边和面必须仍保持直线和平面
*  由一阶单元组成得网格，模拟出得真实复杂得位移和应力场，是有严重得局限性的，并且直线和平面不能正确地模拟曲面型几何模型。

2. 二阶实体四面体单元
*  二阶（高品质）实体四面体单元模拟了二阶（抛物线型）位移场以及相应得一阶应力场（注意抛物型函数得导数是线性函数）。二阶位移场命名了该单元得名称：二阶单元。
*  每个二阶四面体单元有十个节点（四个角点和六个中间节点），并且每个节点有三个自由度。
*  当单元因加载而变形时，如果单元需要模拟曲线型几何模型，则二阶单元得边和面就可以是曲线型形状。

## Day 35 COMSOL网格剖分中不同尺寸设置的最佳方式

你想知道构建网格剖分序列的最佳方式吗？比如说，通过单独的操作节点对域进行网格剖分与使用同一操作对整体域进行剖分有什么区别吗？在本博客中，我们将讨论构建网格剖分序列的不同方法，以及这些方法如何影响生成的网格。您将深入了解网格剖分操作在序列中的应用特性。

- [x] 网格剖分操作
1. 结构化操作是映射 和扫掠，生成结构化网格
2. 非结构化操作是自由三角形网格、自由四边形网格 和自由四面体网格，生成非结构化网格。

* 非结构化操作的一个显著特征是它们可以对任何几何结构进行网格剖分，而结构化操作只能对满足特定标准的几何结构进行网格剖分。
* 生成非结构化网格时，单元质量和指定的大小参数都要考虑在内，以便在 COMSOL Multiphysics® 软件得到针对计算的优化网格。
* 除了指定大小参数之外，构建网格剖分序列的方式也将影响最终的网格。

- [x] 网格剖分序列的顺序选择

网格剖分序列与顺序相关。

假设我们想要研究二维模式下的两个相邻正方形。在右侧的正方形中，我们想要使用较细化的网格，原因可能是材料要求，也可能是我们要研究的物理场需要。

我们通过创建两个 自由三角形网格 节点来构建网格剖分序列。

在第一个 自由三角形网格 节点中，我们选择左侧域，在第二个节点中，我们选择右侧域（如下图所示）。接下来，我们将全局大小 节点设置为预定义的超粗化，这是因为，最好在第一个全局大小 节点中指定最粗化网格大小。

进一步阅读使用网格剖分序列教程模型中关于使用局部和全局大小 节点的内容（特别是 PDF 文档的第 10 页）。

为了指定较细化的网格，我们将一个局部大小 节点添加到第二个自由三角形网格 节点，并指定预定义大小超细化。
COMSOL Multiphysics 中网格划分序列的屏幕截图，其中高亮显示了不同的节点。
网格剖分序列包含全局 大小、两个 自由三角形网格和一个 局部大小节点。

绘制生成的网格时，我们可以看到左侧域完全由粗化网格剖分，而右侧域中共享边界附近有一些粗化单元。这是因为共享边界的边界网格由第一个操作指定，因此在其附近不存在任何细化单元。此外，共享边界右侧的粗化单元的质量低于其他单元。
网格划分序列中首先对左侧域进行网格划分得到的低质量网格的屏幕截图。
首先对左侧域进行网格剖分得到的网格。尽管我们指定右侧域的网格为 超细化，右侧域中还是有一些低质量的粗化单元。

如果我们交换两个自由三角形网格 节点的顺序，以相反的顺序执行操作（首先对右侧域进行网格剖分），我们会得到不同的结果。在结果图中，我们可以看到现在的共享边界由比之前更细化的网格组成。因此，右侧域现在完全由细化单元组成，而左侧域共享边界附近有一些细化单元。因而，网格中单元数量增加了，最小单元质量 几乎增加了一倍，这意味着网格的整体质量提高了。
首先对右侧域进行网格划分得到的质量提高的网格的屏幕截图。
首先对右侧域进行网格剖分得到的网格。现在，右侧域只包含细化单元，整体单元质量得到提高。

这里需要注意的是，先前操作生成的网格将对任何后续操作创建的网格产生约束。本例中，这意味着在先前网格边界附近生成的网格将会受到该边界单元尺寸的影响。

使用单个操作对多个域进行网格剖分
现在，我们设想一个稍有不同的例子。假设我们研究的是相同设置的正方形，但每个正方形在共享边界附近有一个圆孔。本例中，我们假设我们希望两个域都具有相同的单元大小。与前面的示例类似，我们通过在网格剖分序列中添加两个自由三角形网格 节点并将它们分别应用于左右两个域来构建网格剖分序列。这次，我们将全局大小 节点设置为预定义大小常规，并且不添加任何其他大小 节点。

最终得到的网格图不像我们预期的那样令人满意。在研究该绘图时，我们可以看到共享边界和下部孔之间的窄区域中的单元质量较差。由于首先对左侧域进行网格剖分，因此在生成边界网格时不会考虑右侧域的几何结构。因为下部孔与边界之间的区域很窄，所以需要生成比共享边界上更小的单元，从而避免低质量单元。
首先对带孔的左侧域进行网格划分得到的低质量网格图。
首先对左侧域进行网格剖分得到的网格。首先对左侧域进行网格剖分，不会考虑右侧域的几何结构。结果，共享边界与下部孔之间的窄区域包含低质量单元。

此序列设置将无法生成在几何结构的所有区域都具有高质量单元的网格。在这种情况下，交换操作的顺序没有帮助，问题只会转移到上部窄区域。解决方案是仅使用一个自由三角形网格 操作，并将其应用于两个域，这样网格剖分算法可以同时包含整个几何结构，并构建适合于两个域的边界网格。

阅读上一篇博客文章”改进的四面体单元网格剖分功能“，了解生成四面体网格的详细过程。

当我们用一个操作绘制由序列生成的网格时，我们可以看到下部窄区域中的单元质量有了很大的提高。
同时对带孔的域进行网格划分得到的高质量网格图。
同时对两个域进行网格剖分得到的网格。由于边界网格是针对两个域生成的，因此下部窄区域中的网格质量得到改善。

即使我们可能在两个相邻域中具有相同的大小规格，我们对这两个域进行剖分的顺序也会对最终的网格产生很大的影响。需要注意的是，使用单个操作对多个域进行网格剖分时，计算机能够并行生成网格。出于这些原因，建议使用尽可能少的操作。

三维示例
最后，我们将在三维模式下研究盒子内的线圈，以了解这些效果如何体现在更高级的几何结构中。我们使用的是内置线圈几何单导线线圈 – 矩形导线、跑道型、闭侧，可在“AC/DC 模块”的零件库中找到。在我们的模型中，我们在线圈周围添加一个盒子，并调整线圈，使一对线圈之间的区域变得非常窄，这意味着线圈之间需要非常细化的网格，以避免低质量单元。本例中，我们希望生成的网格为：周围盒子中的网格较粗化，线圈中的网格较细化，线圈之间窄区域中的网格足够细化。
三维线圈模型的几何结构。
线圈几何结构。放大视图显示了线圈匝之间的窄区域。

我们将全局大小 节点设置为预定义值粗化，然后开始构建网格剖分序列。为了在窄区域中获得足够小的网格，我们必须调整参数最小单元大小，以便可以解析间距约为 1.7e-4m 的窄区域。这可以通过在全局大小 节点中选择自定义 并将最小单元大小 设置为 2e-4 m，如下图所示。接下来，我们添加两个自由四面体网格 操作，在第一个操作中选择线圈，在第二个操作中选择周围的盒子。在作用于线圈的第一个自由四面体网格 节点上，我们添加一个局部大小 节点，并将其设置为预定义值常规。
网格单元大小设置窗口的屏幕截图。
全局 大小节点设置为 粗化，最小单元大小设置为自定义值 2e-4 m。

在下图中，我们可以看到类似于二维示例的结果：即使我们指定了较小的最小单元大小，窄区域的单元质量仍然非常差。同样，这是网格剖分操作顺序导致的。当通过第一个操作对线圈进行网格剖分时，周围盒子中的窄区域不会对边界上的单元大小产生约束。因此，边界网格是根据线圈上指定的网格大小（即常规）生成的。对周围的盒子进行网格剖分时，共享边界的网格是固定的，因此窄区域中的网格单元只能为偏斜形状。
线圈在周围域之前进行网格划分得到的网格图。
首先对线圈进行网格剖分得到的网格。请注意，已排除半个盒子和一个线圈，以便查看。由于首先对线圈进行网格剖分，因此窄区域（红色）中生成的四面体网格质量较差。

接下来，我们按照最佳实践构建一个新的网格剖分序列。添加单个自由四面体网格 操作并将其应用于整个几何结构。我们在操作中添加一个局部大小 节点，默认值为常规，设置域选择为线圈（如下图所示）。全局大小 节点的设置与上一个序列相同。
选中“自由四面体网格”操作的网格单元设置的屏幕截图。
局部 大小节点指定代表线圈的域 2-11 的单元大小。

在构建这个网格剖分序列时，考虑到周围的几何结构，用非常细化的网格对线圈边界的边界网格进行网格剖分。这样，窄区域中生成的网格单元更细化且质量更好。
为获得高质量单元而使用一个操作对线圈和周围域进行网格划分得到的网格图。
同时对两个域进行网格剖分得到的网格。由于整个几何结构在一个操作中进行网格剖分，因此内部边界上的网格比以前细化得多，从而使窄区域中的单元质量更好。

- [x] 总结
1. 网格剖分序列中的操作顺序对最终的网格有影响，这是因为生成的网格是固定的，因此来自前一个操作节点的任何网格都是后续操作的基础。
2. 最佳做法是使用尽可能少的操作，并添加全局或局部大小 节点。此外，如果你需要在序列中进行多个操作（例如，想要使用不同的单元类型），考虑它们的顺序非常重要。

## Day 36 Hypermesh三维网格划分

> [Hypermesh三维网格划分](https://zhuanlan.zhihu.com/p/71398148)

- [x] 网格划分步骤
1. 几何部件分组及重命名
2. 几何部件修复处理，切分区域
3. 规划二维单元划分顺序和路径，检查并通过质量要求
4. 三维网格生成（包含各种网格生成方法）
5. 单元质量检查和改善
6. 自由边及自由面检查

- [x] 网格划分实例
<img width="546" alt="image" src="https://user-images.githubusercontent.com/43568675/189312239-5fb09dd1-3083-4007-a076-69e4816fed0d.png">

1、由于结构较为单一，也无需进行修复完善。首先我们基于网格划分要求，对连杆结构进行切分。因为整个结构存在对称性，所以直接切取1/4部分进行网格划分，然后通过对称操作获得整体结构的网格模型，切分之后的几何体如图2和图3所示。


实体区域切分的好坏对整个划分工作具有引领的作用，切分的好，后续工作基本如鱼得水，否则又是各种烦杂操作，所以切忌着急动手，先在心中打草稿规划。

<img width="461" alt="image" src="https://user-images.githubusercontent.com/43568675/189312316-35f83f2c-b908-4cb7-8bc2-7f5d2f377189.png">
图2 切出1/4几何体

<img width="674" alt="image" src="https://user-images.githubusercontent.com/43568675/189312372-68c3b77f-f28b-4fce-8515-f1a4e9e6247b.png">

图3 1/4几何体切分结果
在进行几何体的切分之时，主要涉及的命令有硬点的添加、实体的编辑操作（切割、删除等）、面切割等，各命令面板如图4所示。


<img width="1005" alt="image" src="https://user-images.githubusercontent.com/43568675/189312781-c188ea51-c607-4970-aa4a-9ef34364dc3f.png">
<img width="1003" alt="image" src="https://user-images.githubusercontent.com/43568675/189312821-751b4188-7dfc-4078-bc84-12cee8e27ff1.png">
<img width="1003" alt="image" src="https://user-images.githubusercontent.com/43568675/189312890-0e66adc9-6a72-4d42-83e7-c991d7a0f8da.png">


图4 命令面板


2、实体进行切分之后，我们可以删除实体基于面划分网格，也可以直接进行二维单元的划分，直接利用automesh等二维网格划分命令进行操作。

基本是在本步骤按照常规的操作即可，绘制满足要求的单元并有利于实体网格的生成。绘制结果部分如图5所示。

<img width="623" alt="image" src="https://user-images.githubusercontent.com/43568675/189313524-0876cf83-f308-440f-989c-d80505e5e45b.png">

图5 二维网格单元
3、生成三维实体单元。实体单元生成主要依赖于常用的几个命令如general、line drag等，如图6所示。

<img width="663" alt="image" src="https://user-images.githubusercontent.com/43568675/189313555-5ece11ac-adcc-45d0-8f96-406327de98ec.png">

图6 实体单元生成面板
以切分出的相贯区域为例，我们可以利用general命令实现实体单元的生成。如图7所示，单击element选择二维单元，然后单击surf选中目标面，最后通过along gemo:mixed对单元的生成进行限制，生成实体单元。

<img width="669" alt="image" src="https://user-images.githubusercontent.com/43568675/189313594-06af6f68-d882-41af-bdfa-472f0ee4ffa4.png">

<img width="617" alt="image" src="https://user-images.githubusercontent.com/43568675/189313619-af6d71b0-d425-4282-8679-53b3a78b3d1a.png">



图7 general生成实体网格
4、同样的方法，生成其它区域的实体单元，如图8所示，最后生成整体的1/4网格单元，并检查单元之间的节点连接，如图9所示。


图8 其它区域的实体网格实现

图9 1/4实体网格
5、镜像生成整体连杆结构的实体单元，如图10所示。镜像过程需要对原始的网格进行复制（duplicate）。



图10 整体实体单元的生成
6、对整体实体单元的节点连续性进行检查，利用tool面板下的face命令生成单元表面，然后再后处理中进行切割展示，如图11所示，可以看到整个结构内部中空不存在额外的多余连接面，表明网格连续。


图11 网格检查结果
通过以上各步骤操作，我们基本上完成了连杆结构的三维网格划分，并且能够获得较为满意的实体单元，最终如图12所示。


图12 连杆三维单元划分结果
