## Day 32 ABAQUS的网格划分

ABAQUS的网格划分方法是首先对几何模型布置种子来控制单元密度和位置，然后使用自动算法直接生成网格。下面就详细地介绍一下在ABAQUS中网格的划分方法。
01 网格种子

全局种子：设定整个部件或者实体上的单元尺寸。（Mesh,edge上seed的多少决定region 里mesh的多少）
边上的种子：设定边上的单元数目或者单元尺寸大小，在Constraints一栏中有三个选择：

◆ 边上的种子无约束：划分网格时，边上的节点数目可以超出或者少于种子的数目，无约束的种子用圆圈表示。
◆ 边上的种子受部分约束：划分网格时，边上的节点数目可以超出种子的数目，但不能少于种子的数目。受约束的种子用三角形表示。
◆ 边上的种子完全受约束：划分网格时，边上的节点位置与种子的位置严格吻合，受完全约束的种子用方形表示。

有时候我们需要对局部网格进行加密或者进行结构化网格划分时需要进行二合一或者三合一的操作时就要对边的种子进行控制。见图1和图2。

<img width="560" alt="image" src="https://user-images.githubusercontent.com/43568675/188413596-704f8d62-831a-414e-b8b1-c94ab20b47b9.png">


02 单元形状
网格控制选项中可以选择单元类型。
1. 对于二维几何模型，可以选择以下的单元形状：
*  Quad：网格中完全使用四边形单元。
*  Quad-dominated：网格中主要使用四边形单元，但在过渡区域允许出现三角形单元。（选择此类型更容易实现从粗网格到细网格的过渡。）
*  Tri：网格中完全使用三角形网格单元。

2. 对于三维几何模型，可以选择以下的单元形状：
*  Hex：网格中完全使用六面体单元。
*  Hex-dominated：网格中主要使用六面体单元，但在过渡区域允许出现楔形单元。
*  Tet：网格中完全使用四面体单元。
*  Wedge：网格中完全使用楔形单元。

03 网格划分技术
1. 在网格控制选项中显示了三种网格划分技术：
* Structured（结构化网格）：将一些标准的网格模式应用于一些形状简单的几何区域，结构化网格区域显示为绿色。
* Sweep（扫掠网格）：对于二维几何模型，首先在边上生成网格，然后沿扫掠路径拉伸得到二维网格；对于三维几何模型，首先在面上生成网格，然后沿扫掠路径拉伸得到三维网格。扫掠网格区域为黄色。
* Free(自由网格)：自由网格是最为灵活的网格划分技术，几乎可以用于任意的几何形状。自由网格划分区域为粉红色。(见图3)

2.  如果某个区域显示为橙色，表明无法使用目前的网格划分技术，这时需要对模型进行切分或者使用其他的网格划分方法。
<img width="642" alt="image" src="https://user-images.githubusercontent.com/43568675/188413659-b93cc55f-b79e-494c-bda3-571b72383f43.png">

*这里说明网格划分具有模型检查机制，能够对模型是否适用于某种网格划分进行预先检测

04 网格划分算法
1. 在网格控制选项中提供了两种算法：
* Medial Axis(中性轴算法)：首先把要划分网格的区域分为一些简单的区域，然后使用结构化网格划分技术对这些区域进行网格划分。
* Advancing Front算法：首先在边界上生成四边形网格，然后再向区域内部拓展。

<img width="498" alt="image" src="https://user-images.githubusercontent.com/43568675/188413842-1beed223-291b-4e05-b17a-c428969397c5.png">

2. 对比两种算法生成的网格发现：
* Medial Axis算法更容易得到形状规则的网格，但网格与种子的位置吻合的较差。
* Advancing Front算法得到的网格可以与种子的位置很好地吻合，而且更容易得到单元大小均匀的网格，但在较窄区域为了精确匹配每粒种子可能会使网格倾斜。

在实际应用中，具体使用哪种网格算法更好，需要根据具体情况而定。
例如在ABAQUS显式分析中网格中的小单元会限制增量步长，这时使用Advancing Front算法可以得到大小更加均匀的网格。

## Day 33 comsol 手动网格剖分技巧：几何分割的概念

> [借助分割技巧改进网格剖分](https://cn.comsol.com/blogs/improving-your-meshing-with-partitioning/#goto-comments)

- [x] 网格剖分算法的工作方式

1. 缺省网格设定：始终使用自由剖分四面体网格来将任意体离散为多个更小的单元。
2. 缺省单元类型是四面体单元，因为对于任意几何，不论拓扑多复杂，都可以细分并近似为四面体。

*有些情况下更适合使用其他网格

网格剖分算法示意图
<img width="697" alt="image" src="https://user-images.githubusercontent.com/43568675/188639110-76044c83-0bf0-4a35-8c8e-383ee3318801.png">

圆柱（左）表面使用三角形单元（灰色）进行网格剖分；四面体网格剖分算法使用四面体单元对体进行细分（青色）。出于清晰的考虑，两端已省略。

* 四面体网格剖分算法会首先在您希望进行网格剖分的体的所有面上应用三角形网格。体随即被细分为四面体，以便能考虑到边界上的所有三角形，同时保持体内四面体的尺寸和形状都满足指定的尺寸和增长准则。

* 如果您收到类似“处理几何面上的边界线单元失败”的错误消息，可能是因为四面体的形状在该过程中变得过于扭曲。

自由剖分四面体网格算法的执行可能会遇到一些问题，比如：

* 部件非常复杂，混合了非常详细的区域和稀疏网格。
* 用来定义域的边和边界的纵横比非常大。



- [x] 简化复杂几何
开始之前，让我们先考虑一个稍微复杂的几何：螺旋几何基元。

继续操作，打开一个新的 COMSOL 模型文件并创建一个十圈螺旋，然后通过缺省设定进行网格剖分，如下图所示。


<img width="672" alt="image" src="https://user-images.githubusercontent.com/43568675/188639803-46d13263-7cf4-495a-bfb2-3d1f5c418132.png">

剖分一个十匝几何基元。十圈螺旋基元及对应的缺省四面体网格。

在剖分这一相对简单部件时您可能会发现，剖分步骤花费的时间相对较长。因此，我们将分析如何借助分割来简化几何。

1. 初步简化步骤
* 在几何序列中增加一个工作平面，沿螺旋的长度方向对其进行二等分
* 然后增加分割特征，使用工作平面作为分割对象。

<img width="703" alt="image" src="https://user-images.githubusercontent.com/43568675/188641805-796e07cf-4c67-42dd-9f7f-b354fa21f943.png">

用于分割螺旋的工作平面。

* 得到的十匝螺旋对象现在包含 20 个不同的域，每个域都代表了半匝螺旋。
* 重新对模型进行网格剖分时，耗时大为缩短，与初始问题相比，每个域均代表了一个更加简单的剖分问题，
* 可以利用并行或多核计算机对这些域进行网格剖分

2. 进一步简化步骤

我们现在有 20 个不同的域，已将螺旋的 6 个表面再分割为 102 个表面，还引入了用于分隔域的内边界。

虽然现在几何的网格剖分速度要快很多，但我们增加了过多的域和边界，可能会影响对材料属性与边界条件的设定；实际上，我们希望在网格剖分时使用分割的几何，同时能在设定物理场时忽略分割。

* 增加虚拟操作 > 网格控制域运算。此特征会将用于定义螺旋的所有 20 个域作为输入，将初始螺旋作为输出，在设定材料属性与物理场时，只需处理 1 个域和 6 条边界。
 
 <img width="683" alt="image" src="https://user-images.githubusercontent.com/43568675/188642808-986678d9-c2b2-4ef6-89fa-3bab5a977dd6.png">

 网格控制域将指定这些是仅用于网格剖分的不同的域。


3. 优势

* 在剖分该几何时同时利用这两大优势。网格剖分花费的时间相对较短，而且能轻松进行物理场设定。
* 比如外形像梳子、蛇纹石或包含许多孔、开孔对象的域，或嵌入其中的域，所有这些情况都应考虑使用分割。
* 并非必须使用平面进行分割，还可以创建并使用其他对象进行分割。

- [x] 高纵横比几何

如何保留几何的微小特征

<img width="686" alt="image" src="https://user-images.githubusercontent.com/43568675/188642865-da839006-8b4d-4ccb-a86a-86cbaf147f5a.png">

要进行网格剖分的流动域。从主管道上向外拉伸的三个包含更小圆角的小型入口。

在上方几何中，从一个大型管道向外拉伸出三个较小的管道。二者的过渡区域采用了小圆角，其尺寸不到管道体积的 1/100。如果我们采用缺省的网格设定来剖分域，则会在整个过程中采用相同的设定。但我们更希望在入口处采用较小的网格尺寸。

1. 缺省网格会在模型的所有单元中使用同一设定，这并不太适用于这一场景。
2. 我们可以在网格中增加额外的尺寸特征，并在小管道周围的所有面中应用这些特征来调整边界处的单元尺寸，但这并不是最佳选择。这需要进行大量操作，而且并非完全能实现我们的目的。
3. 我们还可以使用分割来定义希望应用不同网格设定的小体。下图中，每个小管道的周围加入了一个额外的圆柱，并向下延伸到主管道处。

<img width="691" alt="image" src="https://user-images.githubusercontent.com/43568675/188643148-a7238cd5-11b4-47e0-82c4-6db8142dd216.png">

将用于分割蓝色域的额外的域（线框）。

<img width="700" alt="image" src="https://user-images.githubusercontent.com/43568675/188643823-a5913468-9420-4e52-aafd-23a49a510ced.png">

分割操作结果。

如上图所示，这些附加的圆柱对象可用于分割原始模拟域。

我们将再次使用网格控制域将该几何简化为单个域，方便物理场和材料设定。

执行网格剖分步骤时，可在网格序列中增加尺寸特征，以设定这些新分割域的单元尺寸。这样，我们将能控制这些域的单元尺寸，使网格剖分更为简单。


<img width="720" alt="image" src="https://user-images.githubusercontent.com/43568675/188644944-3ec1c7ac-b9b5-4536-8683-b3186d19d081.png">

可以在每个分割的几何中应用不同的尺寸特征。

- [x]  自动网格剖分失败后如何操作？

对于文中提到的几何，我们只需花费很少的精力或略微修改缺省网格设定即可完成网格剖分。

一个无法通过网格剖分算法在相对合理的时间内完成剖分的几何。这时应该如何处理呢？

1. 分治算法。
当碰到一个未进行网格剖分的域时，可以使用分割将它分为两个域。尝试单独对每个域进行网格剖分。如果其中一个域未剖分，继续分割每半个域。通过这一方法，您将能快速放大原始域中的问题区域。随即决定是否希望通过虚拟操作简化几何的问题部分，或者使用此处列出的技巧对子域逐个进行剖分，您甚至能综合使用这两个技巧。

2. 在导入几何的所有边界上应用自由剖分三角形网格。
与体的网格剖分相比，对表面进行网格剖分更快，而且成功率极高。只需目测一下生成的表面网格，便能轻松发现模型中的小特征及问题区域。一旦了解问题所在之处，即可删除自由剖分三角形网格，因为这一剖分算法通常希望调整边界上的网格，但如果定义了表面网格，将不会执行此操作。

3. 除了我们提到的用于简化几何以便执行网格剖分的虚拟操作，您还可以使用修复和削除功能来清理从其他源中获取的 CAD 数据。虚拟操作将为 CAD 几何简单创建一个抽象对象，只能在 COMSOL 软件内使用，相比之下，修复和削除操作会直接修改 CAD 并创建一个修改的 CAD 表征，支持从COMSOL Multiphysics 写出并写入其他软件包。

- [x]  分割在网格剖分中的用法总结
我们已分析了缺省网格设定并非最优方案的两个不同的典型案例：极度复杂的域和带有极端纵横比的域。这两种情况下，我们都可以使用分割与网格控制域虚拟操作特征来简化网格剖分操作。

我们还提到了不使用缺省设定对几何进行网格剖分的应对策略。另外还需注意一点，当导入的 CAD 几何主要用于制造而非分析目的时，往往会出现这类情况。如果 CAD 文件包含许多装饰性而非功能性的特征，或者您非常确定它们不会影响问题的物理场，可以考虑在导入 COMSOL Multiphysics 之前先在原始 CAD 包中移除这些特征。

如何结合分割与扫略网格剖分，这是 COMSOL Multiphysics 的另一项非常强大的技巧。




